apiVersion: data.fluid.io/v1alpha1
kind: Dataset
metadata:
  name: s3-data
spec:
  mounts:
    - mountPoint: "s3://model/bloom-560/"
      name: bloom-560m
      path: /bloom-560
      options:
        fs.s3.region: ""
        fs.s3.endpoint: "192.168.0.200:9000"
      encryptOptions:
        - name: fs.s3.accessKeyId
          valueFrom:
            secretKeyRef:
              name: s3creds
              key: AWS_ACCESS_KEY_ID
        - name: fs.s3.accessKeySecret
          valueFrom:
            secretKeyRef:
              name: s3creds
              key: AWS_SECRET_ACCESS_KEY
  accessModes:
    - ReadOnlyMany

  tolerations:
    - key: "local-node"
      operator: "Exists"
      effect: "NoSchedule"
  nodeAffinity:
    required:
      nodeSelectorTerms:
        - matchExpressions:
            - key: kubernetes.io/hostname
              operator: In
              values:
                - "ubuntu-gpu-wk"
  placement: "Shared"
---
apiVersion: data.fluid.io/v1alpha1
kind: JindoRuntime
metadata:
  name: s3-data
spec:
  replicas: 1
  tieredstore:
    levels:
      - mediumtype: SSD
        path: /mnt/ssd0/cache
        quota: 8Gi
        high: "0.95"
        low: "0.7"
  master:
    nodeSelector:
      kubernetes.io/hostname: ubuntu-gpu-wk
    tolerations:
    - key: "local-node"
      operator: "Exists"
      effect: "NoSchedule"
  fuse:
    properties:
      fs.jindofsx.data.cache.enable: "true"
      # performance optimization
      fs.jindofsx.stream.maxPendingBlocks: "200"
      fs.s3.download.queue.size: "16"
      fs.s3.download.thread.concurrency: "32"
      fs.s3.read.readahead.buffer.count: "16"
    args:
      - -okernel_cache
      - -oro
      - -oattr_timeout=7200
      - -oentry_timeout=7200
      - -ometrics_port=9089
    cleanPolicy: OnDemand
