apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: trino
  namespace: argocd
spec:
  project: default
  source:
    repoURL: https://trinodb.github.io/charts/
    targetRevision: 0.28.0
    chart: trino
    helm:
      values: |
       server:
         workers: 1
       worker: 
         jvm:
           maxHeapSize: 2G
       coordinator:
         jvm:
           maxHeapSize: 2G
         config:
           query:
             maxMemoryPerNode: 1GB
       additionalCatalogs:
        hive: |
          connector.name=hive
          fs.native-s3.enabled=true
          hive.metastore.uri=thrift://metastore.hive:9083
          s3.aws-access-key=minioadmin
          s3.aws-secret-key=minioadmin
          s3.endpoint=http://minio.frederik-coquelet:9000
          s3.ssl.enabled=false
          s3.path-style-access=true
          hive.non-managed-table-writes-enabled=true
          # s3select-pushdown.enabled=true
          hive.ignore-absent-partitions=true
          # By default, we cannot drop table
          #hive.allow-drop-table=true
        iceberg: |
          connector.name=iceberg
          fs.native-s3.enabled=true
          iceberg.catalog.type=HIVE_METASTORE
          hive.metastore.uri=thrift://metastore.hive:9083
          s3.aws-access-key=minioadmin
          s3.aws-secret-key=minioadmin
          s3.path-style-access=true
          s3.endpoint=http://minio.frederik-coquelet:9000
          s3.ssl.enabled=false
          # By default, we cannot drop table
          # hive.allow-drop-table=true
        nessie: |
          connector.name=iceberg
          iceberg.catalog.type=nessie
          iceberg.nessie-catalog.uri=http://release-name-nessie.nessie:19120/api/v2
          iceberg.nessie-catalog.ref=main
          iceberg.nessie-catalog.default-warehouse-dir=s3://saprk/warehouse
          fs.native-s3.enabled=true
          s3.endpoint=http://minio.frederik-coquelet:9000
          s3.region=us-east-1
          s3.aws-access-key=minioadmin
          s3.aws-secret-key=minioadmin
          s3.exclusive-create=true
          s3.path-style-access=true
        
  destination:
    server: https://kubernetes.default.svc
    namespace: trino
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true
